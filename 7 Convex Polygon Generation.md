
# 凸多边形的生成
这是生成 navmesh 的第四步，从 contour表示的多边形 转换到 凸多边形

---
## 主流程
这个阶段的主流程如下
- contour的顶下是在体素空间下的，所以坐标是基于heightfield原点 并且 坐标也都是整数（因为是描述第几个体素）。所以contour顶点的坐标将被转换回 原始几何体所在的空间
- 由于每个contour都是独立的，所以这个阶段会合并一些重复数据，并放到一张单独的mesh中
- 因为contour只是用来表示简单的多边形，包括了凸多边形和凹多边形。凹多边形在navmesh中没有用（不能穿墙呗）。所以要按需切分来获得凸多边形
- 收集每个多边形边 两侧的多边形 (Polygon neighbor information)

坐标转换 和 顶点合并 这两个步骤比较简单，所以这里就不提了，自己夯代码

这里关注多边形的分解，有如下步骤：
- 对每个contour 进行三角化
- 合并三角形 来尽可能获得较大的三角形

这个阶段将以 连接信息的收集 作为结束

---
## 三角化
遍历contour的顶点，每三个作为一组，即 012、123、234， 判断是不是是不是一个内部三角形。 如果是内部三角形，那么就作为一个候选先放着

三角化的过程如下：
- 找到所有潜在的划分边 （partition / partition edges）
<img src="img/7/convex_01_potpar.png" />

- 找到所有 划分边 中最短的一条，并构建所在的三角形。 同时干掉不会再用的一些 划分边
<img src="img/7/convex_02_part01.png" />

- 遍历完一圈顶点 同时 确定一些三角形之后，在剩下的多边形中，再来一次，看图吧
<img src="img/7/convex_02_part02.png" />
<img src="img/7/convex_02_part03.png" />

---
## Detecting Valid Partitions
有两种算法用来判断 三个顶点构成的三角形 是否可以构成一个有效的内部三角形
- 第一种比较快，可以剔除掉完全在 多边形之外的 划分线
- 如果划分线在多边形内部， 另外一个开销比较大的算法将用来保证 划分线 不会和已经存在的多边形边相交

### The Internal Angle Algorithm